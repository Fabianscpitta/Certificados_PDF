<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <link href="estilos/style.css" rel="stylesheet">
    <link href="estilos/pdf.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/apple-icon-180x180.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" >
                <img class="imgjave" src="img/javeriana-web-logo-edu.png" alt="">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
             <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <!-- <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li> -->
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Programas en curso</a>
                    </li><br>
                    <li class="nav-item">
                        <a class="nav-link" href="finalizados.html">Programas finalizados</a>
                    </li>
                </ul>
            </div> 
        </div>
    </nav>

    <div class="container">
        <div>
            <h1 class="titulo text-center">Programas en curso</h1><br><br>
        </div>
        <div class="col">
            <div class="row">
                <form class="form1" id="miFormulario">
                    <fieldset>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="nombres" class="form-label">Nombres y apellidos</label>
                                <input type="text" class="form-control" id="nombres" required
                                    placeholder="Ingrese su nombre">
                            </div>
                            <div class="col">
                                <label for="Tipo-de-documento" class="form-label">Tipo de documento</label>
                                <select id="Tipo-de-documento" class="form-select" required>
                                    <option value="" disabled selected>Seleccione el documento</option>
                                    <option value="CC">CC</option>
                                    <option value="CE">CE</option>
                                    <option value="TI">TI</option>
                                    <option value="Pasaporte">Pasaporte</option>
                                    <option value="Documento de identidad">Documento de identidad</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="numero_de_identificacion" class="form-label">Número de identificación</label>
                                <input type="text" class="form-control" id="numero_de_identificacion" required placeholder="Ingrese su número de identificación">
                            </div>
                            <div class="col">
                                <label for="sexo" class="form-label">Sexo</label>
                                <select id="sexo" class="form-select" required>
                                    <option value="" disabled selected>Seleccione su sexo</option>
                                    <option value="Femenino">Femenino</option>
                                    <option value="Masculino">Masculino</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="modalidad" class="form-label">Modalidad</label>
                                <select id="modalidad" class="form-select" required>
                                    <option value="" disabled selected>Seleccione la Modalidad</option>
                                    <option value="presencial">presencial</option>
                                    <option value="semipresencial">semipresencial</option>
                                    <option value="virtual asincronico">virtual asincrónico</option>
                                    <option value="virtual sincronico">virtual sincrónico</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="programa" class="form-label">Programa</label>
                                <input type="text" class="form-control" id="programa" required
                                    placeholder="Ingrese el programa">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="facultad" class="form-label">Facultad</label>
                                <select id="facultad" class="form-select" required>
                                    <option value="" disabled selected>Seleccione la Facultad</option>
                                    <option value="Arquitectura y Diseño">Arquitectura y Diseño</option>
                                    <option value="Artes">Artes</option>
                                    <option value="Ciencias">Ciencias</option>
                                    <option value="Ciencias Económicas y Administrativas">Ciencias Económicas y Administrativas</option>
                                    <option value="Ciencias Jurídicas">Ciencias Jurídicas</option>
                                    <option value="Ciencias Políticas y Relaciones Internacionales">Ciencias Políticas y Relaciones Internacionales</option>
                                    <option value="Ciencias Sociales">Ciencias Sociales</option>
                                    <option value="Comunicación y Lenguaje">Comunicación y Lenguaje</option>
                                    <option value="Derecho Canónico">Derecho Canónico</option>
                                    <option value="Educación">Educación</option>
                                    <option value="Enfermería">Enfermería</option>
                                    <option value="Estudios Ambientales y Rurales">Estudios Ambientales y Rurales</option>
                                    <option value="Facultad">Facultad</option>
                                    <option value="Filosofía">Filosofía</option>
                                    <option value="Ingeniería">Ingeniería</option>
                                    <option value="Instituto de Bioética">Instituto de Bioética</option>
                                    <option value="Instituto de Derechos Humanos">Instituto de Derechos Humanos</option>
                                    <option value="Instituto de Salud Pública">Instituto de Salud Pública</option>
                                    <option value="Instituto Pensar">Instituto Pensar</option>
                                    <option value="Medicina">Medicina</option>
                                    <option value="Odontología">Odontología</option>
                                    <option value="Psicología">Psicología</option>
                                    <option value="Teología">Teología</option>
                                    <option value="Salud">Salud</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="intensidad_horaria" class="form-label">Intensidad horaria</label>
                                <input type="number" class="form-control" id="intensidad_horaria" required
                                    placeholder="Ingrese la intensidad horaria">
                            </div>
                            <div class="col">
                                <label for="consecutivo" class="form-label">Consecutivo</label>
                                <input type="number" class="form-control" id="consecutivo" required>
                            </div>

                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <label for="fecha_inicio" class="form-label">Fecha de inicio</label>
                                <input type="date" class="form-control" id="fecha_inicio" required>
                            </div>
                            <div class="col">
                                <label for="fecha_fin" class="form-label">Fecha de fin</label>
                                <input type="date" class="form-control" id="fecha_fin" required>
                            </div>
                            <div class="col">
                                <label for="hora_actual" class="form-label">Hora actual</label>
                                <input type="time" class="form-control" id="hora_actual" required>
                            </div>
                            <div class="col">
                                <label for="fecha_hoy" class="form-label">Fecha de hoy</label>
                                <input type="date" class="form-control" id="fecha_hoy" required>
                            </div>
                        </div><br><br>
                        <div class="text-center">
                            <a class="boton1" href="#" onclick="genPDF(); return false;">Generar PDF</a>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
    <style>
        body{
            background-image: url(img/javeriana-img.png);
            background-size: cover;
            background-repeat: no-repeat;    
        }
    </style>
    <script>
            function genPDF() {
            // Obtener los valores del formulario
            var nombres = document.getElementById('nombres').value;
            var tipoDocumento = document.getElementById('Tipo-de-documento').value;
            var numeroIdentificacion = document.getElementById('numero_de_identificacion').value;
            var sexo = document.getElementById('sexo').value;
            var modalidad = document.getElementById('modalidad').value;
            var programa = document.getElementById('programa').value;
            var facultad = document.getElementById('facultad').value;
            var intensidadHoraria = document.getElementById('intensidad_horaria').value;
            var consecutivo = document.getElementById('consecutivo').value;
            var fechaInicio = document.getElementById('fecha_inicio').value;
            var fechaFin = document.getElementById('fecha_fin').value;
            var horaActual = document.getElementById('hora_actual').value;
            var fechaHoy = document.getElementById('fecha_hoy').value;

             // Verificar si algún campo está vacío
            if (nombres === "" || tipoDocumento === "" || numeroIdentificacion === "" || sexo === "" ||
                modalidad === "" || programa === "" || facultad === "" || intensidadHoraria === "" ||
                consecutivo === "" || fechaInicio === "" || fechaFin === "" || horaActual === "" || fechaHoy === "") {
                alert("Por favor complete todos los campos del formulario.");
                return; // Detener la ejecución si algún campo está vacío
            }
 
            var pronombre = sexo === "Femenino" ? "la" : "el";
            var pronombre2 = sexo === "Femenino" ? "identificada " : "identificado ";

            
           // Obtener las fechas de los elementos input
           var fechaInicio = document.getElementById("fecha_inicio").value;
            var fechaFin = document.getElementById("fecha_fin").value;

            // Ajustar la fecha de inicio sumando un día
            var fechaInicioAjustada = new Date(fechaInicio);
            fechaInicioAjustada.setDate(fechaInicioAjustada.getDate() + 1);

            // Ajustar la fecha de fin sumando un día
            var fechaFinAjustada = new Date(fechaFin);
            fechaFinAjustada.setDate(fechaFinAjustada.getDate() + 1);

            // Obtener los componentes de las fechas
            var diaMesInicio = fechaInicioAjustada.toLocaleDateString('es-ES', { day: '2-digit', month: 'long' });
            var diaMesFin = fechaFinAjustada.toLocaleDateString('es-ES', { day: '2-digit', month: 'long', year: 'numeric' });

            // Obtener la facultad seleccionada
            var facultad = document.getElementById("facultad").value;

            // Determinar si los años son iguales
            var mismoAño = fechaInicioAjustada.getFullYear() === fechaFinAjustada.getFullYear();

            // Construir el texto completo según la facultad seleccionada
            var textoCompleto = "El cual esta siendo dictado ";

            // Verificar si la facultad seleccionada es uno de los institutos específicos
            switch (facultad) {
                case "Instituto de Bioética":
                case "Instituto de Derechos Humanos":
                case "Instituto de Salud Pública":
                case "Instituto Pensar":
                    textoCompleto += "por el " + facultad;
                    break;
                default:
                    textoCompleto += "por la Facultad de " + facultad;
            }

            textoCompleto += ", entre el " + diaMesInicio;

            // Agregar el año a la fecha de fin si los años son diferentes
            if (!mismoAño) {
                textoCompleto += " de " + fechaInicioAjustada.getFullYear();
            }

            textoCompleto += " hasta el " + diaMesFin + ", con una intensidad de " + intensidadHoraria + " horas.";


            




            // Obtener la fecha actual
            var fechaHoy = new Date();
            // Ajustar la fecha actual sumando un día
            fechaHoy.setDate(fechaHoy.getDate());

            // Formatear la fecha actual
            var options = { day: '2-digit', month: 'long', year: 'numeric' };
            var fechaHoyFormateada = fechaHoy.toLocaleDateString('es-ES', options).replace(/\b(de)\b/g, 'de');

            // Obtener el día del mes
            var diaDelMes = fechaHoy.getDate();

            // Obtener la hora actual del campo de entrada
            var horaActualInput = document.getElementById("hora_actual").value;

            // Obtener la hora y los minutos de la hora actual ingresada
            var partesHora = horaActualInput.split(":");
            var hora = parseInt(partesHora[0]);
            var minutos = parseInt(partesHora[1]);

            // Determinar si es AM o PM
            var am_pm = hora >= 12 ? 'PM' : 'AM';

            // Convertir la hora al formato de 12 horas
            hora = hora % 12;
            hora = hora ? hora : 12; // Si es 0, entonces es medianoche

            // Construir el texto completo con la fecha y la hora ingresadas por el usuario
            var textoCompletoFecha = "La presente se expide en Bogotá el día "+ fechaHoyFormateada + " a las " + hora + ":" + (minutos < 10 ? '0' : '') + minutos + ' ' + am_pm;
        
            // Crear el contenido HTML del PDF
            var contenido = `
                <div class="pdf" style="margin: 20px;">
                    <img class="imgjavepdf" src="img/javeriana-web-logo-edu.png" alt="" style="position: absolute; top: 20px; left: 20px;"><br><br> <br> <br>             
                    <p class="Consecutivo">Codigo de verificación: DEC-${consecutivo}-24<p><br> 
                    <h1 class="titulopdf text-center"><strong>CERTIFICACIÓN DE PROGRAMAS EN CURSO</strong></h1><br>
                    <p">La Dirección de Educación Continua hace constar que ${pronombre} participante <strong>${nombres}</strong> ${pronombre2} con ${tipoDocumento} No. ${numeroIdentificacion} está participando en el siguiente programa:</p><br>
                    <center><p class="Programa"><strong>${programa}</strong></p></center><br>
                    <p>${textoCompleto}<p>
                    <p>${textoCompletoFecha}<p>
                    <center><img class="imgfirma" src="img/firma.png" alt=""></center>
                    <center><p class="nombrefirma"><strong>CÉSAR TULIO OSSA RAMÍREZ</strong><p></center>
                    <center><p class="nombrefirma2"><strong>DIRECTOR EDUCACIÓN CONTINUA</strong><p></center><br>
                    <p class="textobajo"><strong>*El programa de Educación Continua relacionado en la presente certificación no es conducente a título de pregrado o posgrado (especialización,
                    maestría y/o doctorado).</strong><p>
                    <div class="direccion">
                        <p class="dire"><strong>Dirección de Educación Continua – Vicerrectoría de Extensión y Relaciones Interinstitucionales</strong></p>
                        <hr class="hrje">
                        <p class="carrera"><strong>Carrera 7 No 40 A - 93 Edificio Hernando Arellano Ángel. PBX: (57-1)3208320 Ext: 3503 - 2100 Bogotá, D.C., Colombia</strong></p>
                    </div>
                </div>
            `;

            // Obtener el nombre ingresado por el usuario
            var nombres = document.getElementById('nombres').value;

            // Configurar las opciones de html2pdf
            var opt = {
                margin:       [0, 0.9, 0, 0.9], // Márgenes: [arriba, izquierda, abajo, derecha]
                filename:     'Certificación ' + nombres + '.pdf', 
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Crear un contenedor temporal para el contenido HTML
            var tempElement = document.createElement('div');
            tempElement.innerHTML = contenido;
            document.body.appendChild(tempElement);

            // Generar el PDF
            html2pdf().from(tempElement).set(opt).save().then(() => {
                // Eliminar el contenedor temporal después de la generación del PDF
                document.body.removeChild(tempElement);
            });
        }
    </script>
</body>
</html>
